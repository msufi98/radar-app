<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NEXRAD Level 2 Radar Data Viewer - Interactive map-based radar site and data selection">
    <title>NEXRAD Radar Viewer</title>
</head>
<body>
    <!-- Full-screen Map Container -->
    <div id="map" role="application" aria-label="Interactive map of NEXRAD radar sites"></div>

    <!-- Unified Left Panel -->
    <aside class="panel panel--left" aria-label="Radar site and data selection">
        <div class="panel__content">
            <!-- Header moved inside left panel -->
            <header class="panel-header">
                <h1 class="panel-header__title">NEXRAD Level 2 Radar Viewer</h1>
                <button
                    id="resetBtn"
                    class="btn btn--reset"
                    title="Reset all filters and selections"
                    aria-label="Reset all filters and selections"
                >
                    Reset
                </button>
            </header>

            <!-- Data Information Card (builds progressively) -->
            <div id="dataInfoCard" class="data-info-card" style="display: none;">
                <div class="data-info-card__header" id="dataInfoCardHeader">
                    <span class="data-info-card__site-name" id="cardHeaderSiteName"></span>
                    <button class="data-info-card__toggle" id="dataInfoCardToggle" aria-label="Toggle data info">
                        <span class="data-info-card__toggle-arrow">▼</span>
                    </button>
                </div>
                <div class="data-info-card__content" id="dataInfoCardContent">
                    <!-- Site info (added when site selected) -->
                    <div id="cardSiteInfo" class="data-info-item" style="display: none;">
                        <span class="data-info-label">Site:</span>
                        <span class="data-info-value" id="cardSiteName"></span>
                    </div>

                    <!-- Date/Time info (added when time selected) -->
                    <div id="cardDateTime" class="data-info-item" style="display: none;">
                        <span class="data-info-label">Date:</span>
                        <span class="data-info-value" id="cardDate"></span>
                    </div>
                    <div id="cardTime" class="data-info-item" style="display: none;">
                        <span class="data-info-label">Time:</span>
                        <span class="data-info-value" id="cardTimeValue"></span>
                    </div>

                    <!-- Radar data info (added when data parsed) -->
                    <div id="cardVCP" class="data-info-item" style="display: none;">
                        <span class="data-info-label">VCP:</span>
                        <span class="data-info-value" id="cardVCPValue"></span>
                    </div>
                    <div id="cardScans" class="data-info-item" style="display: none;">
                        <span class="data-info-label">Elevations:</span>
                        <span class="data-info-value" id="cardScansValue"></span>
                    </div>
                    <div id="cardRange" class="data-info-item" style="display: none;">
                        <span class="data-info-label">Max Range:</span>
                        <span class="data-info-value" id="cardRangeValue"></span>
                    </div>

                    <!-- Current display info (added when scan displayed) -->
                    <div id="cardElevation" class="data-info-item" style="display: none;">
                        <span class="data-info-label">Elevation:</span>
                        <span class="data-info-value" id="cardElevationValue"></span>
                    </div>
                    <div id="cardReflectivity" class="data-info-item" style="display: none;">
                        <span class="data-info-label">Reflectivity:</span>
                        <span class="data-info-value" id="cardReflectivityValue"></span>
                    </div>
                </div>
            </div>

            <!-- Accordion: Step 1 - Select Radar Site -->
            <div class="accordion-section" data-step="1">
                <div class="accordion-header accordion-header--static" id="step1Header" aria-expanded="true">
                    <span class="accordion-header__title">
                        <span class="accordion-header__step">Step 1:</span>
                        <span class="accordion-header__text">Select Radar Site</span>
                    </span>
                    <span class="accordion-header__status" id="step1Status"></span>
                </div>

                <div class="accordion-content" id="step1Content">
                    <div class="search-section">
                        <label for="siteSearch" class="input-group__label">Search Radar Sites</label>
                        <input
                            type="text"
                            id="siteSearch"
                            class="input input--search"
                            placeholder="Search by code, name, or state..."
                            aria-describedby="searchHelp"
                        >
                        <div id="selectedSite" class="site-selection" role="status" aria-live="polite"></div>
                    </div>
                    <button
                        id="selectRadarBtn"
                        class="btn btn--primary btn--full"
                        disabled
                    >
                        Select Radar
                    </button>
                </div>
            </div>

            <!-- Accordion: Step 2 - Select Date & Time -->
            <div class="accordion-section accordion-section--disabled" data-step="2">
                <div class="accordion-header accordion-header--static" id="step2Header" aria-expanded="false">
                    <span class="accordion-header__title">
                        <span class="accordion-header__step">Step 2:</span>
                        <span class="accordion-header__text">Select Date & Time</span>
                    </span>
                    <span class="accordion-header__status" id="step2Status"></span>
                </div>

                <div class="accordion-content" id="step2Content" style="display: none;">
                    <!-- Date Selectors -->
                    <div id="dateTimeControls" class="date-selectors">
                        <div class="input-group">
                            <label for="yearSelect" class="input-group__label">Year</label>
                            <select id="yearSelect" class="select" aria-required="true">
                                <option value="">Select Year</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="monthSelect" class="input-group__label">Month</label>
                            <select id="monthSelect" class="select" disabled aria-required="true">
                                <option value="">Select Month</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="daySelect" class="input-group__label">Day</label>
                            <select id="daySelect" class="select" disabled aria-required="true">
                                <option value="">Select Day</option>
                            </select>
                        </div>
                    </div>

                    <!-- Status Messages -->
                    <div id="dataStatus" class="status-message" role="alert" aria-live="polite"></div>

                    <!-- Time Selector -->
                    <section id="timeSelector" class="time-selector" style="display: none;" aria-label="Available scan times">
                        <h3 class="time-selector__heading">Available Times (Click to Load)</h3>
                        <div id="timesList" class="times-grid"></div>
                    </section>
                </div>
            </div>

            <!-- Accordion: Step 3 - Select Scan Information -->
            <div class="accordion-section accordion-section--disabled" data-step="3">
                <div class="accordion-header accordion-header--static" id="step3Header" aria-expanded="false">
                    <span class="accordion-header__title">
                        <span class="accordion-header__step">Step 3:</span>
                        <span class="accordion-header__text">Select Scan Information</span>
                    </span>
                    <span class="accordion-header__status" id="step3Status"></span>
                </div>

                <div class="accordion-content" id="step3Content" style="display: none;">
                    <!-- Radar Status Messages -->
                    <div id="radarStatus" class="status-message" role="alert" aria-live="polite"></div>

                    <div id="radarControls">
                        <div class="input-group">
                            <label for="resolutionSelect" class="input-group__label">Resolution</label>
                            <select id="resolutionSelect" class="select">
                                <option value="">Select Resolution</option>
                                <option value="auto">Auto (All Scans)</option>
                                <option value="360">Low Resolution (360 radials)</option>
                                <option value="720">High Resolution (720 radials)</option>
                            </select>
                        </div>

                        <div class="input-group">
                            <label for="scanLevelSelect" class="input-group__label">Scan Level (Elevation) - Select to Display</label>
                            <select id="scanLevelSelect" class="select" disabled>
                                <option value="">Select Resolution First</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <!-- Map Controls (Floating Bottom-Left) -->
    <aside id="mapControls" class="map-controls" style="display: none;" aria-label="Map zoom and pan controls">
        <div class="map-controls__pan">
            <button id="mapPanUp" class="map-control-btn map-control-btn--pan" title="Pan up" aria-label="Pan up">▲</button>
            <div class="map-controls__pan-horizontal">
                <button id="mapPanLeft" class="map-control-btn map-control-btn--pan" title="Pan left" aria-label="Pan left">◀</button>
                <button id="mapPanRight" class="map-control-btn map-control-btn--pan" title="Pan right" aria-label="Pan right">▶</button>
            </div>
            <button id="mapPanDown" class="map-control-btn map-control-btn--pan" title="Pan down" aria-label="Pan down">▼</button>
        </div>
        <div class="map-controls__zoom">
            <button id="mapZoomOut" class="map-control-btn map-control-btn--zoom" title="Zoom out" aria-label="Zoom out">−</button>
            <button id="mapZoomIn" class="map-control-btn map-control-btn--zoom" title="Zoom in" aria-label="Zoom in">+</button>
        </div>
    </aside>

    <!-- Reflectivity Legend (Floating Bottom-Left) -->
    <aside id="reflectivityLegend" class="legend" style="display: none;" aria-label="Reflectivity scale legend">
        <div class="legend__content">
            <h3 class="legend__title">Reflectivity (dBZ)</h3>
            <div class="legend__scale-container">
                <canvas id="legendCanvas" class="legend__canvas"></canvas>
                <svg id="legendTicks" class="legend__ticks"></svg>
            </div>
            <div class="legend__labels">
                <span class="legend__label legend__label--min" id="legendMin"></span>
                <span class="legend__label legend__label--mid" id="legendMid"></span>
                <span class="legend__label legend__label--max" id="legendMax"></span>
            </div>
        </div>
    </aside>

    <!-- Floating Detail View Panel -->
    <aside id="zoomWindow" class="floating-panel floating-panel--zoom" style="display: none;">
        <div class="floating-panel__header floating-panel__header--zoom">
            <div class="floating-panel__header-row">
                <h3 class="floating-panel__title">Detail View</h3>
                <div class="floating-panel__controls">
                    <button id="zoomInBtn" class="zoom-control-btn" title="Zoom in (smaller area)" aria-label="Zoom in">+</button>
                    <button id="zoomOutBtn" class="zoom-control-btn" title="Zoom out (larger area)" aria-label="Zoom out">−</button>
                </div>
            </div>
            <div class="floating-panel__coords" id="zoomCoords"></div>
        </div>
        <div class="floating-panel__map-container">
            <div id="zoomMap" class="floating-panel__map"></div>
            <canvas id="zoomCanvas" class="floating-panel__overlay"></canvas>
            <div id="zoomLoadingOverlay" class="floating-panel__loading-overlay" style="display: none;"></div>
        </div>
    </aside>

    <!-- Floating Vertical Cross-Section Panel -->
    <aside id="crossSectionWindow" class="floating-panel floating-panel--vertical" style="display: none;">
        <div class="floating-panel__header">
            <h3 class="floating-panel__title">Vertical Cross-Section</h3>
            <div class="floating-panel__info" id="crossSectionInfo">
                Click and drag on the map to view detailed data.
            </div>
        </div>
        <div class="floating-panel__canvas-container">
            <canvas id="crossSectionCanvas" class="floating-panel__canvas"></canvas>
        </div>
    </aside>

    <!-- Floating Arc Cross-Section Panel -->
    <aside id="horizontalCrossSectionWindow" class="floating-panel floating-panel--horizontal" style="display: none;">
        <div class="floating-panel__header">
            <h3 class="floating-panel__title">Arc Cross-Section</h3>
            <div class="floating-panel__info" id="arcCrossSectionInfo">
                Height vs. Azimuth (±15°)
            </div>
        </div>
        <div class="floating-panel__canvas-container">
            <canvas id="horizontalCrossSectionCanvas" class="floating-panel__canvas"></canvas>
        </div>
    </aside>

    <!-- Google Maps API Loader -->
    <script>
        (g=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await (a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n))})({
            key: "AIzaSyA5Lz7efVijEPENVUhJBIPY_718UehmL_U",
            v: "beta"
        });
    </script>
</body>
</html>